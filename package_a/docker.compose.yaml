services:

  # service that installs os level dependencies that ros needs (eg. hardware interfaces)
  package_a-base:
    container_name: package_a-base
    pull_policy: build
    build:
      context: ${PACKAGE_A_HOST_DIR}
      dockerfile: dockerfiles/base.Dockerfile
    image: "package_a:base"

  # service that sets custom users, installs rosdeps, and builds the package
  package_a-build:
    container_name: package_a-build
    pull_policy: build   # change to image if you already have a prebuilt thing you want to pull
    build:
      args:
        TARGET_WORKSPACE_DIR: ${PACKAGE_A_TARGET_WS} 
      context: ${PACKAGE_A_HOST_DIR}
      dockerfile: dockerfiles/build.Dockerfile
    image: "package_a:build"
    depends_on:
      package_a-base:
        condition: service_completed_successfully
    command: tail -f /dev/null
